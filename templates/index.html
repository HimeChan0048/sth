<!DOCTYPE html>
<html style="font-size: 16px;">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <meta name="keywords" content="">
  <meta name="description" content="">
  <meta name="page_type" content="np-template-header-footer-from-plugin">
  <title>index</title>
  <link href="{{ url_for('static', path='/css/index.css') }}" rel="stylesheet" media="screen">
  <link href="{{ url_for('static', path='/css/nicepage.css') }}" rel="stylesheet" media="screen">
  <script class="u-script" type="text/javascript" src="{{ url_for('static', path='/jquery.js') }}" defer=""></script>
  <script class="u-script" type="text/javascript" src="{{ url_for('static', path='/nicepage.js') }}" defer=""></script>


  <link id="u-theme-google-font" rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i">
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <script src="{{ url_for('static', path='/blockly-master/javascript_compressed.js') }}"></script>
  <script src="{{ url_for('static', path='/blockly-master/scripts/package/blockly.js') }}"></script>
  <script src="{{ url_for('static', path='/blockly-master/scripts/package/blocks.js') }}"></script>
  <script src="{{ url_for('static', path='/blockly-master/msg/js/en.js') }}"></script>
  <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": ""
}</script>
  <meta name="theme-color" content="#478ac9">
  <meta property="og:title" content="index">
  <meta property="og:type" content="website">
</head>

<body data-home-page="index.html" data-home-page-title="index" class="u-body">
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <script>

    var ws = new WebSocket("ws://localhost:8000/ws");
    ws.onmessage = function (event) {
      if (event.data[0] == "s") {
        document.getElementById("state").innerText = "Status : " + event.data.slice(1, -1)
      }
      else {
        addlist(event.data)
      }

    }
    ws.onopen = function (e) {
      getlist()
    }
    function setstate() {
      ws.send("s")
    }
    time = 0
    function addlist(list) {
      str = '<ul id="list" class="u-text u-text-2" onclick="runCode();getlist()">'
      var aContainer = document.createElement('div');
      list = list.slice(1, -1).split(",")
      for (let i = 0; i < list.length; i++) {
        str += "<li>" + list[i]
        if ({{ UID }} == list[i]) {
        str += " (you)"
      }

      str += "</li>"
    }
    aContainer.innerHTML = str
    str += '</ul>'
    var elem = document.getElementById("list");
    elem.parentNode.removeChild(elem);
    document.getElementById("listbox").appendChild(aContainer);
    setTimeout(() => { getlist() }, 5000);
    }
    function getlist() {
      ws.send("c" + {{ UID }})
    }
    function up(q, UID) {
      ws.send("aUP " + {{ UID }})
      }
    function left(q, UID) {
      ws.send("aLEFT " + {{ UID }})
      }
    function down(q, UID) {
      ws.send("aDOWN " + {{ UID }})
      }
    function right(q, UID) {
      ws.send("aRIGHT " + {{ UID }})
      }
    function turnleft(q, UID) {
      ws.send("aTLEFT " + {{ UID }})
      }
    function turnright(q, UID) {
      ws.send("aTRIGHT " + {{ UID }})
      }
    function stoprobot(q, UID) {
      ws.send("aSTOP " + {{ UID }})
      }
    function ONE(q, UID) {
      ws.send("aHOME " + {{ UID }})
      }
    function TWO(q, UID) {
      ws.send("aPOSE_1 " + {{ UID }})
      }
    function THREE(q, UID) {
      ws.send("aPOSE_2 " + {{ UID }})
      }
    function goa(q, UID) {
      ws.send("aGOTO_A " + {{ UID }})
      }
    function gob(q, UID) {
      ws.send("aGOTO_B " + {{ UID }})
      }
    function goc(q, UID) {
      ws.send("aGOTO_C " + {{ UID }})
      }
    window.onbeforeunload = closingCode;
    function closingCode() {
      ws.send({{ UID }})
    return null;
      }

  </script>


  <section class="u-clearfix u-section-1" id="sec-066d">
    <div class="u-clearfix u-sheet u-sheet-1">
      <div class="u-clearfix u-expanded-width u-gutter-0 u-layout-wrap u-layout-wrap-1">
        <div class="u-layout">
          <div class="u-layout-row">
            <div class="u-container-style u-hidden-md u-hidden-sm u-hidden-xs u-layout-cell u-size-37 u-layout-cell-1">
              <div class="u-container-layout u-container-layout-1">
                <div class="u-preserve-proportions u-video u-video-contain u-video-1">
                  <div class="embed-responsive embed-responsive-1">
                    <iframe style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;"
                      class="embed-responsive-item"
                      src="https://www.youtube.com/embed/dQw4w9WgXcQ?mute=0&amp;showinfo=0&amp;controls=0&amp;start=0"
                      frameborder="0" allowfullscreen=""></iframe>
                  </div>
                </div>
                <p id="state" class="u-hidden-md u-hidden-sm u-hidden-xs u-text u-text-1" onclick="setstate()">Status :
                  Initializing</p>
                <div
                  class="u-border-2 u-border-grey-75 u-container-style u-group u-hidden-md u-hidden-sm u-hidden-xs u-radius-11 u-shape-round u-group-1">
                  <div id="listbox" class="u-container-layout u-container-layout-2">
                    <ul id="list" class="u-text u-text-2" onclick="runCode();getlist()">
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="u-container-style u-layout-cell u-size-23 u-layout-cell-2">
              <div class="u-container-layout u-container-layout-3">
                <div
                  class="u-expanded-width u-hidden-md u-hidden-sm u-hidden-xs u-tab-links-align-justify u-tabs u-tabs-1">
                  <ul class="u-tab-list u-unstyled" role="tablist">
                    <li class="u-tab-item" role="presentation">
                      <a class="active u-active-custom-color-1 u-border-2 u-border-grey-75 u-button-style u-tab-link u-tab-link-1"
                        id="link-tab-089d" href="#tab-089d" role="tab" aria-controls="tab-089d"
                        aria-selected="true">Blockly Mode</a>
                    </li>
                    <li class="u-tab-item" role="presentation">
                      <a class="u-active-custom-color-1 u-border-2 u-border-grey-75 u-button-style u-tab-link u-tab-link-2"
                        id="link-tab-fcd8" href="#tab-fcd8" role="tab" aria-controls="tab-fcd8"
                        aria-selected="false">Easy Mode</a>
                    </li>
                    <li class="u-tab-item u-tab-item-3" role="presentation">
                      <a class="u-active-custom-color-1 u-border-2 u-border-grey-75 u-button-style u-tab-link u-tab-link-3"
                        id="link-tab-e160" href="#tab-e160" role="tab" aria-controls="tab-e160"
                        aria-selected="false">Manual Mode</a>
                    </li>
                  </ul>
                  <div class="u-tab-content">
                    <div
                      class="u-container-style u-custom-color-2 u-shape-rectangle u-tab-active u-tab-pane u-tab-pane-1"
                      id="tab-089d" role="tabpanel" aria-labelledby="link-tab-089d">
                      <div id="blocklyDiv" class="u-container-layout u-container-layout-4"></div>
                    </div>
                    <div class="u-container-style u-custom-color-2 u-shape-rectangle u-tab-pane u-tab-pane-2"
                      id="tab-fcd8" role="tabpanel" aria-labelledby="link-tab-fcd8">
                      <div class="u-container-layout u-container-layout-5">
                        <p class="u-text u-text-body-color u-text-default u-text-3">Position Control <span
                            style="font-weight: 400;"></span>
                        </p>
                        <a class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-2-base u-palette-2-base u-radius-6 u-btn-1"
                          onclick="goa()">Go to (A)</a>
                        <a class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-2-base u-palette-2-base u-radius-6 u-btn-2"
                          onclick="gob()">Go to (B)</a>
                        <a class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-2-base u-palette-2-base u-radius-6 u-btn-3"
                          onclick="goc()">Go to (C)</a>
                        <p class="u-text u-text-body-color u-text-default u-text-4">Arm Control</p>
                        <a class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-2-base u-palette-2-base u-radius-6 u-btn-4"
                          onClick="ONE()">Home pose</a>
                        <a class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-2-base u-palette-2-base u-radius-6 u-btn-5"
                          onClick="TWO()">Pose 1</a>
                        <a class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-2-base u-palette-2-base u-radius-6 u-btn-6"
                          onClick="THREE()">Pose 2</a>
                      </div>
                    </div>
                    <div class="u-container-style u-custom-color-2 u-shape-rectangle u-tab-pane u-tab-pane-3"
                      id="tab-e160" role="tabpanel" aria-labelledby="link-tab-e160">
                      <div class="u-container-layout u-container-layout-6">
                        <img onmousedown="up()" onmouseup="stoprobot()"
                          class="u-image u-image-default u-preserve-proportions u-image-1"
                          src="{{ url_for('static', path='images/uarrow.png') }}" alt="" data-image-width="77"
                          data-image-height="77">
                        <div class="u-opacity u-opacity-75 u-shape u-shape-svg u-text-custom-color-1 u-shape-1">
                          <svg class="u-svg-link" preserveAspectRatio="none" viewBox="0 0 160 160" style="">
                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-f2db"></use>
                          </svg>
                          <svg class="u-svg-content" viewBox="0 0 160 160" x="0px" y="0px" id="svg-f2db">
                            <path d="M155,160H5c-2.8,0-5-2.2-5-5.1V80.5c0-1.3,0.5-2.6,1.5-3.5l75-75.5c2-1.9,5.1-1.9,7,0l75,75.5c0.9,0.9,1.5,2.2,1.5,3.5v74.4
	C160,157.8,157.8,160,155,160z"></path>
                          </svg>
                        </div>
                        <img onmousedown="turnright()" onmouseup="stoprobot({{q|tojson|safe}})"
                          class="u-image u-image-default u-preserve-proportions u-image-2"
                          src="{{ url_for('static', path='images/trarrow.png') }}" alt="" data-image-width="77"
                          data-image-height="77">
                        <img onmousedown="turnleft()" onmouseup="stoprobot({{q|tojson|safe}})"
                          class="u-image u-image-default u-preserve-proportions u-image-3"
                          src="{{ url_for('static', path='images/tlarrow.png') }}" alt="" data-image-width="77"
                          data-image-height="77">
                        <img onmousedown="left()" onmouseup="stoprobot({{q|tojson|safe}})"
                          class="u-image u-image-default u-preserve-proportions u-image-4"
                          src="{{ url_for('static', path='images/larrow.png') }}" alt="" data-image-width="77"
                          data-image-height="77">
                        <img onmousedown="right()" onmouseup="stoprobot({{q|tojson|safe}})"
                          class="u-image u-image-default u-preserve-proportions u-image-5"
                          src="{{ url_for('static', path='images/rarrow.png') }}" alt="" data-image-width="77"
                          data-image-height="77">
                        <img onmousedown="down()" onmouseup="stoprobot({{q|tojson|safe}})"
                          class="u-image u-image-default u-preserve-proportions u-image-6"
                          src="{{ url_for('static', path='images/darrow.png') }}" alt="" data-image-width="77"
                          data-image-height="77">
                        <a class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-2-base u-palette-2-base u-radius-23 u-text-active-white u-text-white u-btn-7"
                          onclick="EMERGENCY()">EMERGENCY STOP1</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <xml xmlns="https://developers.google.com/blockly/xml" id="workspaceBlocks" style="display: none"></xml>
  <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
    <category name="M">
      <block type="forward"></block>
      <block type="backward"></block>
      <block type="left"></block>
      <block type="right"></block>
      <block type="turnleft"></block>
      <block type="turnright"></block>
    </category>
    <category name="E">
      <block type="goa"></block>
      <block type="gob"></block>
      <block type="goc"></block>
    </category>
  </xml>
  <script>
    function runCode() {
      console.log("called");
      time = 0
      window.LoopTrap = 1000;
      Blockly.JavaScript.INFINITE_LOOP_TRAP = 'if(--window.LoopTrap == 0) throw "Infinity loop";\n'
      var code = Blockly.JavaScript.workspaceToCode(workspace);
      eval(code);
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
    }
    /* TODO: Change toolbox XML ID if necessary. Can export toolbox XML from Workspace Factory. */
    var toolbox = document.getElementById("toolbox");

    var options = {
      toolbox: toolbox,
      collapse: true,
      comments: true,
      disable: true,
      maxBlocks: Infinity,
      trashcan: true,
      horizontalLayout: false,
      toolboxPosition: 'start',
      css: true,
      media: 'https://blockly-demo.appspot.com/static/media/',
      rtl: false,
      scrollbars: false,
      sounds: true,
      oneBasedIndex: true
    };

    /* Inject your workspace */
    var workspace = Blockly.inject('blocklyDiv', options);

    /* Load Workspace Blocks from XML to workspace. Remove all code below if no blocks to load */

    /* TODO: Change workspace blocks XML ID if necessary. Can export workspace blocks XML from Workspace Factory. */
    var workspaceBlocks = document.getElementById("workspaceBlocks");

    /* Load blocks to workspace. */
    Blockly.Xml.domToWorkspace(workspaceBlocks, workspace);

    Blockly.Blocks['forward'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("Go forward for ");
        this.appendDummyInput()
          .appendField(new Blockly.FieldNumber(0, 0), "Time");
        this.appendDummyInput()
          .appendField("seconds");
        this.setInputsInline(true);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(30);
        this.setTooltip("");
        this.setHelpUrl("");
      }
    };


    Blockly.JavaScript['forward'] = function (block) {
      // TODO: Assemble JavaScript into code variable.
      var operator = block.getFieldValue('Time');

      setTimeout(() => { up({{ q| tojson | safe}}); }, (time) * 1000);
    setTimeout(() => { stoprobot({{ q| tojson | safe}}); }, (operator + time) * 1000);
    time = time + operator;

    var code = '...;\n';
    return code;
};

    Blockly.Blocks['backward'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("Go backward for ");
        this.appendDummyInput()
          .appendField(new Blockly.FieldNumber(0, 0), "Time");
        this.appendDummyInput()
          .appendField("seconds");
        this.setInputsInline(true);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(30);
        this.setTooltip("");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['backward'] = function (block) {
      // TODO: Assemble JavaScript into code variable.
      var operator = block.getFieldValue('Time');
      setTimeout(() => { down({{ q| tojson | safe}}); }, (time) * 1000);
    setTimeout(() => { stoprobot({{ q| tojson | safe}}); }, (operator + time) * 1000);
    time = time + operator;

    var code = '...;\n';
    return code;
    };

    Blockly.Blocks['left'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("Strafe left for ");
        this.appendDummyInput()
          .appendField(new Blockly.FieldNumber(0, 0), "Time");
        this.appendDummyInput()
          .appendField("seconds");
        this.setInputsInline(true);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(30);
        this.setTooltip("");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['left'] = function (block) {
      // TODO: Assemble JavaScript into code variable.
      var operator = block.getFieldValue('Time');
      setTimeout(() => { left({{ q| tojson | safe}}); }, (time) * 1000);
    setTimeout(() => { stoprobot({{ q| tojson | safe}}); }, (operator + time) * 1000);
    time = time + operator;
    var code = '...;\n';
    return code;
    };

    Blockly.Blocks['right'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("Strafe right for ");
        this.appendDummyInput()
          .appendField(new Blockly.FieldNumber(0, 0), "Time");
        this.appendDummyInput()
          .appendField("seconds");
        this.setInputsInline(true);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(30);
        this.setTooltip("");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['right'] = function (block) {
      // TODO: Assemble JavaScript into code variable.
      var operator = block.getFieldValue('Time');
      setTimeout(() => { right({{ q| tojson | safe}}); }, (time) * 1000);
    setTimeout(() => { stoprobot({{ q| tojson | safe}}); }, (operator + time) * 1000);
    time = time + operator;
    var code = '...;\n';
    return code;
    };

    Blockly.Blocks['turnleft'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("Turn left for ");
        this.appendDummyInput()
          .appendField(new Blockly.FieldNumber(0, 0), "Time");
        this.appendDummyInput()
          .appendField("seconds");
        this.setInputsInline(true);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(30);
        this.setTooltip("");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['turnleft'] = function (block) {
      // TODO: Assemble JavaScript into code variable.
      var operator = block.getFieldValue('Time');
      setTimeout(() => { turnleft({{ q| tojson | safe}}); }, (time) * 1000);
    setTimeout(() => { stoprobot({{ q| tojson | safe}}); }, (operator + time) * 1000);
    time = time + operator;
    var code = '...;\n';
    return code;
    };

    Blockly.Blocks['turnright'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("Turn right for ");
        this.appendDummyInput()
          .appendField(new Blockly.FieldNumber(0, 0), "Time");
        this.appendDummyInput()
          .appendField("seconds");
        this.setInputsInline(true);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(30);
        this.setTooltip("");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['turnright'] = function (block) {
      // TODO: Assemble JavaScript into code variable.
      var operator = block.getFieldValue('Time');
      setTimeout(() => { turnright({{ q| tojson | safe}}); }, (time) * 1000);
    setTimeout(() => { stoprobot({{ q| tojson | safe}}); }, (operator + time) * 1000);
    time = time + operator;
    var code = '...;\n';
    return code;
    };

    Blockly.Blocks['goa'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("Go to position A");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(90);
        this.setTooltip("Go to A");
        this.setHelpUrl("");
      }
    };
    Blockly.JavaScript['goa'] = function (block) {
      // TODO: Assemble JavaScript into code variable.
      goa({{ q| tojson | safe}});
    var code = '...;\n';
    return code;
    };

    Blockly.Blocks['gob'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("Go to position B");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(90);
        this.setTooltip("Go to B");
        this.setHelpUrl("");
      }
    };
    Blockly.JavaScript['gob'] = function (block) {
      // TODO: Assemble JavaScript into code variable.
      gob({{ q| tojson | safe}});
    var code = '...;\n';
    return code;
    };

    Blockly.Blocks['goc'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("Go to position C");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(90);
        this.setTooltip("Go to C");
        this.setHelpUrl("");
      }
    };
    Blockly.JavaScript['goc'] = function (block) {
      // TODO: Assemble JavaScript into code variable.
      goc({{ q| tojson | safe}});
    var code = '...;\n';
    return code;
    };
  </script>
</body>

</html>